syntax = "proto3";

package tk.api;

import "db/db.proto";

message GetSettingsRequest {}
message GetSettingsResponse {
  db.Settings settings = 1;
}

message UpdateSettingsRequest {
  int64 next_session_threshold_secs = 1;
  bool discord_enabled = 17;
  string discord_bot_token = 2;
  string discord_guild_id = 3;
  string discord_announcement_channel_id = 4;
  string discord_notification_channel_id = 24;
  bool discord_self_link_enabled = 5;
  bool discord_name_sync_enabled = 6;
  int64 discord_start_reminder_mins = 7;
  int64 discord_end_reminder_mins = 8;
  string discord_start_reminder_message = 9;
  string discord_end_reminder_message = 10;
  bool discord_overtime_dm_enabled = 11;
  int64 discord_overtime_dm_mins = 12;
  string discord_overtime_dm_message = 13;
  bool discord_auto_checkout_dm_enabled = 14;
  string discord_auto_checkout_dm_message = 15;
  bool discord_checkout_enabled = 16;
  string timezone = 18;
  string primary_color = 19;
  string secondary_color = 20;
  bool leaderboard_show_overtime = 21;
  repeated db.TeamMemberType leaderboard_member_types = 22;
  bool discord_rsvp_reactions_enabled = 23;
}
message UpdateSettingsResponse {}

message UploadLogoRequest {
  bytes logo = 1;
}
message UploadLogoResponse {}

message GetLogoRequest {}
message GetLogoResponse {
  bytes logo = 1;
}

message PurgeDatabaseRequest {}
message PurgeDatabaseResponse {}

message DiscordRole {
  string id = 1;
  string name = 2;
}

message GetDiscordRolesRequest {}
message GetDiscordRolesResponse {
  repeated DiscordRole roles = 1;
}

message ImportDiscordMembersRequest {
  string role_id = 1;
  db.TeamMemberType member_type = 2;
}
message ImportDiscordMembersResponse {
  int32 imported = 1;
  int32 linked = 2;
  int32 already_linked = 3;
}

service SettingsService {
  rpc GetSettings(GetSettingsRequest) returns (GetSettingsResponse);
  rpc UpdateSettings(UpdateSettingsRequest) returns (UpdateSettingsResponse);
  rpc UploadLogo(UploadLogoRequest) returns (UploadLogoResponse);
  rpc GetLogo(GetLogoRequest) returns (GetLogoResponse);
  rpc PurgeDatabase(PurgeDatabaseRequest) returns (PurgeDatabaseResponse);
  rpc GetDiscordRoles(GetDiscordRolesRequest) returns (GetDiscordRolesResponse);
  rpc ImportDiscordMembers(ImportDiscordMembersRequest) returns (ImportDiscordMembersResponse);
}
